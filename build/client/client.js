"use strict";(()=>{var c=e=>new Promise(t=>setTimeout(t,e)),o=[];function h(e){return Math.floor(Math.random()*e)}o[0]=new Array;o[0].Debug=!0;o[0].TaxiCabHash="taxi";o[0].CommandCoolDownTime=1;o[0].CostPerUnit=.05;o[1]=["g_m_m_armgoon_01","g_m_m_korboss_01","mp_m_avongoon"];var w=global.exports,F=w["qb-core"].GetCoreObject(),a,g,S=!1,v=[],T,G=PlayerId(),P,r,C=!1,D,B=0;P=setTick(async()=>{await c(5e3),T===!1&&C&&(console.log("NeedBlip is now false"),SetBlipScale(r,0),RemoveBlip(r),C=!1),T===!0&&(C||(console.log("spawning blip"),r=AddBlipForEntity(a),SetBlipSprite(r,198),SetBlipDisplay(r,4),SetBlipScale(r,.5),SetBlipColour(r,2),SetBlipAsShortRange(r,!0),BeginTextCommandSetBlipName("STRING"),AddTextComponentString("Your Taxi Driver"),C=!0))});onNet("zc-aitaxi:client:CreateCabAndDriver",async()=>{if(S)emit("QBCore:Notify","You can't call another taxi yet....","error",15);else{var e=h(o[1].length),[t,s,l]=GetEntityCoords(GetPlayerPed(-1)),u=GetEntityHeading(GetPlayerPed(-1));o[0].Debug&&console.log("Player Coords : ("+t+","+s+","+l+","+u+")");let[d,n,y]=GetRandomVehicleNode(t,s,l,75,!1,!1,!1),[b,i,p]=GetClosestVehicleNodeWithHeading(n[0],n[1],n[2],0,3,0),[f,m]=GetPointOnRoadSide(t,s,l,0);if(o[0].Debug&&(console.log("Did we find a road? : "+d),console.log("Taxi Spawn Coords : ("+i+")")),d){for(;!HasModelLoaded(o[0].TaxiCabHash)||!HasModelLoaded(o[1][e]);)await c(1e3),RequestModel(o[0].TaxiCabHash),RequestModel(o[1][e]);a==null&&(a=CreateVehicle(o[0].TaxiCabHash,i[0],i[1],i[2],p,!0,!0)),SetVehicleDoorsLocked(a,1),w["qb-target"].AddTargetEntity(a,{options:[{type:"client",event:"zc-aitaxi:client:EnterTaxi",icon:"fas fa-dollar",label:"Enter Taxi",src:G,item:"cash"}],distance:2.5}),v.push(a),console.log("The spawned taxi has entity id : "+a),g=CreatePedInsideVehicle(a,4,o[1][e],-1,!0,!0),T=!0,v.push(g),I(a,g,m[0],m[1],m[2],10,10,!1)}else emit("QBCore:Notify","Can't find a way to you! Find a road!","error")}});on("zc-aitaxi:client:EnterTaxi",async e=>{var t;TaskEnterVehicle(PlayerPedId(),a,500,2,16,0,0),t=setTick(async()=>{await c(1500),GetFirstBlipInfoId(8)!==0&&(clearTick(t),k(e.src))}),emit("QBCore:Notify","Please set a GPS marker to start your ride!","success")});function k(e){if(GetFirstBlipInfoId(8)!==0){let s=GetFirstBlipInfoId(8),[l,u,d]=GetBlipInfoIdCoord(s),n=GetEntityCoords(PlayerPedId(),!0),y=l,b=u,i=d;var t=parseInt(GetDistanceBetweenCoords(n[0],n[1],n[2],y,b,i,!1).toString());B=parseInt((o[0].CostPerUnit*t).toString()),o[0].Debug&&console.log("The Distance Traveled for fare calculation is : "+t);let[p,f]=GetClosestVehicleNode(y,b,i,1,3,0);I(a,g,f[0],f[1],f[2],25,55,!0),emit("QBCore:Notify","Starting GPS route! Please hang on to your seat!","success")}else console.log("could not find a gps waypoint")}on("zc-aitaxi:client:StartRoute",async e=>{});on("onResourceStop",e=>{GetCurrentResourceName()==e&&(o[0].DebugEventTracking&&console.log(`${e} is shutting down, deleting entities!`),x(v))});function x(e){for(let t=0;t<e.length;t++)DeleteEntity(e[t]),DeleteObject(e[t])}async function R(){await c(1e4),x(v),RemoveBlip(r),a=null,g=null,S=!0,E()}async function I(e,t,s,l,u,d,n,y){if(TaskVehicleDriveToCoordLongrange(t,e,s,l,u,n,786603,d),SetDriveTaskDrivingStyle(t,786603),SetDriverAggressiveness(t,0),SetEntityMaxSpeed(e,35/2.236936),y)var b=setTick(async()=>{IsControlJustPressed(0,51)&&(o[0].Debug&&console.log("Faster Ride was requested"),D=!0)}),i=setTick(async()=>{var[p,f,m]=GetEntityCoords(PlayerPedId());await c(1e3),D&&(SetEntityMaxSpeed(e,65/2.236936),SetDriveTaskDrivingStyle(t,537133887)),GetDistanceBetweenCoords(p,f,m,s,l,u,!1)<d+5&&(emitNet("zc-aitaxi:server:PayFare",GetPlayerServerId(PlayerId()),B),await c(3e3),TaskLeaveVehicle(PlayerPedId(),e,16),IsPedInAnyVehicle(PlayerPedId(),!1)||(TaskVehicleDriveWander(t,e,25,447),T=!1,await R(),clearTick(i)))})}async function E(){await c(o[0].CommandCoolDownTime*6e4),S=!1}})();
