"use strict";(()=>{var r=e=>new Promise(a=>setTimeout(a,e)),t=[];function S(e){return Math.floor(Math.random()*e)}t[0]=new Array;t[0].Debug=!1;t[0].DebugVerbose=!1;t[0].DebugCommands=!1;t[0].TaxiCabHash="taxi";t[0].CashAsItem=!0;t[0].CommandCoolDownTime=5;t[0].IdleTimer=1;t[0].CostPerUnit=.05;t[1]=["g_m_m_armgoon_01","g_m_m_korboss_01","mp_m_avongoon"];var P=global.exports,q=P["qb-core"].GetCoreObject(),o,f,w=!1,T=[],g,G=PlayerId(),E,h;var R,l,C=!1,x,V=0,A=!1,k=!1,H,v,D=!1;E=setTick(async()=>{await r(5e3),g===!1&&C&&(console.log("NeedBlip is now false"),SetBlipScale(l,0),RemoveBlip(l),C=!1),g===!0&&(C||(console.log("spawning blip"),l=AddBlipForEntity(o),SetBlipSprite(l,198),SetBlipDisplay(l,4),SetBlipScale(l,.5),SetBlipColour(l,2),SetBlipAsShortRange(l,!0),BeginTextCommandSetBlipName("STRING"),AddTextComponentString("Your Taxi Driver"),C=!0))});async function M(){H=setTick(async()=>{if(o!=null&&!v){var e=GetEntityCoords(PlayerPedId(),!0),a=GetEntityCoords(o,!0),i=GetDistanceBetweenCoords(e[0],e[1],e[2],a[0],a[1],a[2],!1);i<5&&IsControlJustPressed(0,23)&&(emit("zc-aitaxi:client:EnterTaxi",[G]),v=!0),i<10&&(D||O(f,o))}o!=null&&IsPedInVehicle(PlayerPedId(),o,!1)&&IsControlJustPressed(0,23)&&(v=!1)})}function B(e){t[0].Debug&&console.log(e)}onNet("zc-aitaxi:client:CreateCabAndDriver",async()=>{if(B("Client Event Create Cab And Driver Called from the server for this client!"),w)emit("QBCore:Notify","You can't call another taxi yet....","error",2e3);else{emit("QBCore:Notify","A taxi will be there shortly...","success",2e3);var e=S(t[1].length),[a,i,s]=GetEntityCoords(GetPlayerPed(-1)),y=GetEntityHeading(GetPlayerPed(-1));t[0].Debug&&console.log("Player Coords : ("+a+","+i+","+s+","+y+")");let[n,c,m]=GetRandomVehicleNode(a,i,s,125,!1,!1,!1),[b,d,u]=GetClosestVehicleNodeWithHeading(c[0],c[1],c[2],0,3,0),[I,p]=GetPointOnRoadSide(a,i,s,0);if(t[0].Debug&&(console.log("Did we find a road? : "+n),console.log("Taxi Spawn Coords : ("+d+")")),n){for(;!HasModelLoaded(t[0].TaxiCabHash)||!HasModelLoaded(t[1][e]);)await r(1e3),RequestModel(t[0].TaxiCabHash),RequestModel(t[1][e]);o==null?o=CreateVehicle(t[0].TaxiCabHash,d[0],d[1],d[2],u,!0,!0):B("There is already a taxi Entity ID: "+o),SetVehicleDoorsLocked(o,1),P["qb-target"].AddTargetEntity(o,{options:[{type:"client",event:"zc-aitaxi:client:EnterTaxi",icon:"fas fa-dollar",label:"Enter Taxi",src:G,item:"cash"}],distance:2.5}),T.push(o),console.log("The spawned taxi has entity id : "+o),f=CreatePedInsideVehicle(o,4,t[1][e],-1,!0,!0),SetPedStayInVehicleWhenJacked(f,!0),g=!0,T.push(f),_(o,f,p[0],p[1],p[2],10,10,!1),w=!0,M()}else emit("QBCore:Notify","Can't find a way to you! Find a road!","error")}});on("zc-aitaxi:client:EnterTaxi",async e=>{TaskEnterVehicle(PlayerPedId(),o,500,2,16,0,0),h=setTick(async()=>{await r(1500),GetFirstBlipInfoId(8)!==0&&(clearTick(h),z())}),emit("QBCore:Notify","Please set a GPS marker to start your ride!","success")});function z(){if(GetFirstBlipInfoId(8)!==0){A=!0;let a=GetFirstBlipInfoId(8),[i,s,y]=GetBlipInfoIdCoord(a),n=GetEntityCoords(PlayerPedId(),!0),c=i,m=s,b=y;var e=parseInt(GetDistanceBetweenCoords(n[0],n[1],n[2],c,m,b,!1).toString());V=parseInt((t[0].CostPerUnit*e).toString()),t[0].Debug&&console.log("The Distance Traveled for fare calculation is : "+e);let[d,u]=GetClosestVehicleNode(c,m,b,1,3,0);_(o,f,u[0],u[1],u[2],25,55,!0),emit("QBCore:Notify","Starting GPS route! Please hang on to your seat!","success")}else console.log("could not find a gps waypoint")}on("zc-aitaxi:client:StartRoute",async e=>{});on("onResourceStop",e=>{GetCurrentResourceName()==e&&(t[0].Debug&&console.log(`${e} is shutting down, deleting entities!`),F(T),clearTick(h),clearTick(R),clearTick(E))});function F(e){for(let a=0;a<e.length;a++)DeleteEntity(e[a]),DeleteObject(e[a])}async function N(){await r(1e4),F(T),RemoveBlip(l),o=null,f=null,A=!1}async function _(e,a,i,s,y,n,c,m){if(TaskVehicleDriveToCoordLongrange(a,e,i,s,y,c,786603,n),SetDriveTaskDrivingStyle(a,786603),SetDriverAggressiveness(a,0),SetEntityMaxSpeed(e,45/2.236936),m){R=setTick(async()=>{await r(500),IsControlJustPressed(0,51)&&(t[0].Debug&&console.log("Faster Ride was requested"),x=!0)});var b=setTick(async()=>{var[d,u,I]=GetEntityCoords(PlayerPedId());await r(1e3),x&&(SetEntityMaxSpeed(e,75/2.236936),SetDriveTaskDrivingStyle(a,537133887)),GetDistanceBetweenCoords(d,u,I,i,s,y,!1)<n+5&&(k||(emitNet("zc-aitaxi:server:PayFare",GetPlayerServerId(PlayerId()),V),k=!0),await r(3e3),TaskLeaveVehicle(PlayerPedId(),e,16),IsPedInAnyVehicle(PlayerPedId(),!1)||(TaskVehicleDriveWander(a,e,25,447),g=!1,await N(),clearTick(b)))})}}async function O(e,a){D=!0,t[0].Debug&&console.log("Taxi Idle timer started");let i=setTick(async()=>{await r(t[0].IdleTimer*6e4),v?(t[0].Debug&&console.log("Taxi Idle timer celared"),clearTick(i),D=!1):(TaskVehicleDriveWander(e,a,25,447),g=!1,t[0].Debug&&console.log("Cleaning up entities due to idleness"),await N())})}})();
