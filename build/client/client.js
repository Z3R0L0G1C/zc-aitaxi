"use strict";(()=>{var r=e=>new Promise(a=>setTimeout(a,e)),t=[];function D(e){return Math.floor(Math.random()*e)}t[0]=new Array;t[0].Debug=!0;t[0].DebugCommands=!0;t[0].TaxiCabHash="taxi";t[0].CashAsItem=!0;t[0].CommandCoolDownTime=5;t[0].IdleTimer=2;t[0].CostPerUnit=.05;t[1]=["g_m_m_armgoon_01","g_m_m_korboss_01","mp_m_avongoon"];var I=global.exports,_=I["qb-core"].GetCoreObject(),o,g,v=!1,T=[],b,k=PlayerId(),R,s,C=!1,w,B=0,S=!1;R=setTick(async()=>{await r(5e3),b===!1&&C&&(console.log("NeedBlip is now false"),SetBlipScale(s,0),RemoveBlip(s),C=!1),b===!0&&(C||(console.log("spawning blip"),s=AddBlipForEntity(o),SetBlipSprite(s,198),SetBlipDisplay(s,4),SetBlipScale(s,.5),SetBlipColour(s,2),SetBlipAsShortRange(s,!0),BeginTextCommandSetBlipName("STRING"),AddTextComponentString("Your Taxi Driver"),C=!0))});onNet("zc-aitaxi:client:CreateCabAndDriver",async()=>{if(v)emit("QBCore:Notify","You can't call another taxi yet....","error",15);else{v=!0,N();var e=D(t[1].length),[a,n,l]=GetEntityCoords(GetPlayerPed(-1)),f=GetEntityHeading(GetPlayerPed(-1));t[0].Debug&&console.log("Player Coords : ("+a+","+n+","+l+","+f+")");let[i,c,m]=GetRandomVehicleNode(a,n,l,75,!1,!1,!1),[p,d,u]=GetClosestVehicleNodeWithHeading(c[0],c[1],c[2],0,3,0),[h,y]=GetPointOnRoadSide(a,n,l,0);if(t[0].Debug&&(console.log("Did we find a road? : "+i),console.log("Taxi Spawn Coords : ("+d+")")),i){for(;!HasModelLoaded(t[0].TaxiCabHash)||!HasModelLoaded(t[1][e]);)await r(1e3),RequestModel(t[0].TaxiCabHash),RequestModel(t[1][e]);o==null&&(o=CreateVehicle(t[0].TaxiCabHash,d[0],d[1],d[2],u,!0,!0)),SetVehicleDoorsLocked(o,1),I["qb-target"].AddTargetEntity(o,{options:[{type:"client",event:"zc-aitaxi:client:EnterTaxi",icon:"fas fa-dollar",label:"Enter Taxi",src:k,item:"cash"}],distance:2.5}),T.push(o),console.log("The spawned taxi has entity id : "+o),g=CreatePedInsideVehicle(o,4,t[1][e],-1,!0,!0),b=!0,T.push(g),P(o,g,y[0],y[1],y[2],10,10,!1)}else emit("QBCore:Notify","Can't find a way to you! Find a road!","error")}});on("zc-aitaxi:client:EnterTaxi",async e=>{var a;TaskEnterVehicle(PlayerPedId(),o,500,2,16,0,0),a=setTick(async()=>{await r(1500),GetFirstBlipInfoId(8)!==0&&(clearTick(a),E())}),emit("QBCore:Notify","Please set a GPS marker to start your ride!","success")});function E(){if(GetFirstBlipInfoId(8)!==0){S=!0;let a=GetFirstBlipInfoId(8),[n,l,f]=GetBlipInfoIdCoord(a),i=GetEntityCoords(PlayerPedId(),!0),c=n,m=l,p=f;var e=parseInt(GetDistanceBetweenCoords(i[0],i[1],i[2],c,m,p,!1).toString());B=parseInt((t[0].CostPerUnit*e).toString()),t[0].Debug&&console.log("The Distance Traveled for fare calculation is : "+e);let[d,u]=GetClosestVehicleNode(c,m,p,1,3,0);P(o,g,u[0],u[1],u[2],25,55,!0),emit("QBCore:Notify","Starting GPS route! Please hang on to your seat!","success")}else console.log("could not find a gps waypoint")}on("zc-aitaxi:client:StartRoute",async e=>{});on("onResourceStop",e=>{GetCurrentResourceName()==e&&(t[0].Debug&&console.log(`${e} is shutting down, deleting entities!`),x(T))});function x(e){for(let a=0;a<e.length;a++)DeleteEntity(e[a]),DeleteObject(e[a])}async function G(){await r(1e4),x(T),RemoveBlip(s),o=null,g=null,S=!1}async function P(e,a,n,l,f,i,c,m){if(TaskVehicleDriveToCoordLongrange(a,e,n,l,f,c,786603,i),SetDriveTaskDrivingStyle(a,786603),SetDriverAggressiveness(a,0),SetEntityMaxSpeed(e,35/2.236936),m)var p=setTick(async()=>{IsControlJustPressed(0,51)&&(t[0].Debug&&console.log("Faster Ride was requested"),w=!0)}),d=setTick(async()=>{var[u,h,y]=GetEntityCoords(PlayerPedId());await r(1e3),w&&(SetEntityMaxSpeed(e,65/2.236936),SetDriveTaskDrivingStyle(a,537133887)),GetDistanceBetweenCoords(u,h,y,n,l,f,!1)<i+5&&(emitNet("zc-aitaxi:server:PayFare",GetPlayerServerId(PlayerId()),B),await r(3e3),TaskLeaveVehicle(PlayerPedId(),e,16),IsPedInAnyVehicle(PlayerPedId(),!1)||(TaskVehicleDriveWander(a,e,25,447),b=!1,await G(),clearTick(d)))});else V(a,e)}async function V(e,a){let n=setTick(async()=>{await r(t[0].IdleTimer*6e4),TaskVehicleDriveWander(e,a,25,447),b=!1,t[0].Debug&&console.log("Cleaning up entities due to idleness"),await G()});S&&clearTick(n)}async function N(){await r(t[0].CommandCoolDownTime*6e4),v=!1}})();
