"use strict";(()=>{var c=e=>new Promise(a=>setTimeout(a,e)),t=[];function h(e){return Math.floor(Math.random()*e)}t[0]=new Array;t[0].Debug=!0;t[0].DebugCommands=!0;t[0].TaxiCabHash="taxi";t[0].CashAsItem=!0;t[0].CommandCoolDownTime=5;t[0].IdleTimer=3;t[0].CostPerUnit=.05;t[1]=["g_m_m_armgoon_01","g_m_m_korboss_01","mp_m_avongoon"];var w=global.exports,F=w["qb-core"].GetCoreObject(),o,g,v=!1,C=[],T,P=PlayerId(),k,i,p=!1,D,I=0,B=!1;k=setTick(async()=>{await c(5e3),T===!1&&p&&(console.log("NeedBlip is now false"),SetBlipScale(i,0),RemoveBlip(i),p=!1),T===!0&&(p||(console.log("spawning blip"),i=AddBlipForEntity(o),SetBlipSprite(i,198),SetBlipDisplay(i,4),SetBlipScale(i,.5),SetBlipColour(i,2),SetBlipAsShortRange(i,!0),BeginTextCommandSetBlipName("STRING"),AddTextComponentString("Your Taxi Driver"),p=!0))});onNet("zc-aitaxi:client:CreateCabAndDriver",async()=>{if(v)emit("QBCore:Notify","You can't call another taxi yet....","error",15);else{v=!0,V();var e=h(t[1].length),[a,r,s]=GetEntityCoords(GetPlayerPed(-1)),f=GetEntityHeading(GetPlayerPed(-1));t[0].Debug&&console.log("Player Coords : ("+a+","+r+","+s+","+f+")");let[n,l,m]=GetRandomVehicleNode(a,r,s,75,!1,!1,!1),[b,d,u]=GetClosestVehicleNodeWithHeading(l[0],l[1],l[2],0,3,0),[S,y]=GetPointOnRoadSide(a,r,s,0);if(t[0].Debug&&(console.log("Did we find a road? : "+n),console.log("Taxi Spawn Coords : ("+d+")")),n){for(;!HasModelLoaded(t[0].TaxiCabHash)||!HasModelLoaded(t[1][e]);)await c(1e3),RequestModel(t[0].TaxiCabHash),RequestModel(t[1][e]);o==null&&(o=CreateVehicle(t[0].TaxiCabHash,d[0],d[1],d[2],u,!0,!0)),SetVehicleDoorsLocked(o,1),w["qb-target"].AddTargetEntity(o,{options:[{type:"client",event:"zc-aitaxi:client:EnterTaxi",icon:"fas fa-dollar",label:"Enter Taxi",src:P,item:"cash"}],distance:2.5}),C.push(o),console.log("The spawned taxi has entity id : "+o),g=CreatePedInsideVehicle(o,4,t[1][e],-1,!0,!0),T=!0,C.push(g),G(o,g,y[0],y[1],y[2],10,10,!1)}else emit("QBCore:Notify","Can't find a way to you! Find a road!","error")}});on("zc-aitaxi:client:EnterTaxi",async e=>{var a;TaskEnterVehicle(PlayerPedId(),o,500,2,16,0,0),a=setTick(async()=>{await c(1500),GetFirstBlipInfoId(8)!==0&&(clearTick(a),R())}),emit("QBCore:Notify","Please set a GPS marker to start your ride!","success")});function R(){if(GetFirstBlipInfoId(8)!==0){B=!0;let a=GetFirstBlipInfoId(8),[r,s,f]=GetBlipInfoIdCoord(a),n=GetEntityCoords(PlayerPedId(),!0),l=r,m=s,b=f;var e=parseInt(GetDistanceBetweenCoords(n[0],n[1],n[2],l,m,b,!1).toString());I=parseInt((t[0].CostPerUnit*e).toString()),t[0].Debug&&console.log("The Distance Traveled for fare calculation is : "+e);let[d,u]=GetClosestVehicleNode(l,m,b,1,3,0);G(o,g,u[0],u[1],u[2],25,55,!0),emit("QBCore:Notify","Starting GPS route! Please hang on to your seat!","success")}else console.log("could not find a gps waypoint")}on("zc-aitaxi:client:StartRoute",async e=>{});on("onResourceStop",e=>{GetCurrentResourceName()==e&&(t[0].Debug&&console.log(`${e} is shutting down, deleting entities!`),x(C))});function x(e){for(let a=0;a<e.length;a++)DeleteEntity(e[a]),DeleteObject(e[a])}async function E(){await c(1e4),x(C),RemoveBlip(i),o=null,g=null,B=!1}async function G(e,a,r,s,f,n,l,m){if(TaskVehicleDriveToCoordLongrange(a,e,r,s,f,l,786603,n),SetDriveTaskDrivingStyle(a,786603),SetDriverAggressiveness(a,0),SetEntityMaxSpeed(e,45/2.236936),m)var b=setTick(async()=>{IsControlJustPressed(0,51)&&(t[0].Debug&&console.log("Faster Ride was requested"),D=!0)}),d=setTick(async()=>{var[u,S,y]=GetEntityCoords(PlayerPedId());await c(1e3),D&&(SetEntityMaxSpeed(e,75/2.236936),SetDriveTaskDrivingStyle(a,537133887)),GetDistanceBetweenCoords(u,S,y,r,s,f,!1)<n+5&&(emitNet("zc-aitaxi:server:PayFare",GetPlayerServerId(PlayerId()),I),await c(3e3),TaskLeaveVehicle(PlayerPedId(),e,16),IsPedInAnyVehicle(PlayerPedId(),!1)||(TaskVehicleDriveWander(a,e,25,447),T=!1,await E(),clearTick(d)))})}async function V(){await c(t[0].CommandCoolDownTime*6e4),v=!1}})();
